{% load static %}
<!DOCTYPE html>
<html>
<head>
	<!-- META -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=950">

	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href={% static 'Shop/css/reset.css'%} />
	<link rel="stylesheet" type="text/css" href={% static 'Shop/css/style.css'%}>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<title>Проект 4 команды, escrow-контракты для интернет-магазина</title>
</head>
<body>
<!-- header-->

<div class="header-container">
	<div class="logo">
		<div class="phone left">
			<h1>Ежедневно c 10:00 до 21:00.</h1>
		</div>
		<div class="command_name">
			<p>Команда №4</p>
			<a href={% url 'index' %}>На главную</a>
		</div>
		<div class="phone right">
			<h1>8 (800) 555 35 35</h1>
			<span class="phone-caption">
				<p>Звоните бесплатно из регионов!</p>
			</span>
			<br>
			<div class="guest_login">
				<h3 id="address"></h3>
				<h3><button id="login_but">Войти</button></h3>
				{% comment %} <h3><a href={% url 'login' %}>Войти</a></h3> {% endcomment %}
			</div>
			<div class="user_login">
				<h3><a href="">Выйти</a></h3>
			</div>
		</div>
	</div>
</div>

<header class="header">
	<div class="clear"></div>
	<div id="infoContainer">
		<a href={% url 'dostavka' %} class="dostavka"><span class="title">Доставка</span>За сутки по СПб,<br/>отправка по всей России!</a>
		<a href={% url 'oplata' %} class="oplata"><span class="title">Оплата</span>0% платежи от регионов,<br/>работаем с юр. лицами!</a>
		<a href={% url 'garanty' %} class="garanty"><span class="title">Гарантия</span>1 год на всю технику!</a>
		<a href={% url 'lk_user' %} class="lk">
			<span class="title">Личный<br>Кабинет</span>
			<p>Сервис  /// </p>
		</a>
		<a href={% url 'contacts' %} class="contacts noBorder"><span class="title">Контакты</span>Работаем каждый день<br/>с 10.00 до 21.00</a>
	</div>

<!-- END header -->

<!-- content -->
<section class="content">
	<ul class="container">
	<li id="iphone">
			<article class="iphone12_pro">
				<img alt="iPhone new" src={% static 'Shop/images/iPhone12_pro.png'%}>
				<h2>iPhone 12 Pro</h2>
				<ul>
				<li>серебристый/графитовый/</li>
				<li>золотой/"тихоокеанский синий"</li>
					<li style="margin-bottom:15px"></li>
				
					<li>iPhone 12 Pro 128GB &mdash; <a href="" class="payButton"><span>104 000</span></a> ₽</li>
					<li>iPhone 12 Pro 256GB &mdash; <a href="" class="payButton"><span>122 000</span></a> ₽</li>
					<li>iPhone 12 Pro 512GB &mdash; <a href="" class="payButton"><span>138 000</span></a> ₽</li>
				<li><br/></li>
				<li>iPhone 12 Pro 128GB &mdash; <span>скоро!</li>
					<li>iPhone 12 Pro 256GB &mdash; <a href="" class="payButton"><span>120 000</span></a> ₽</li>
					<li>iPhone 12 Pro 512GB  &mdash; <a href="" class="payButton"><span>130 000</span></a> ₽</li>
				<li><br/></li>
				<ul>
					<li style="margin-bottom:15px"></li>
				
					<li>iPhone 12 Pro Max 128GB &mdash; <a href="" class="payButton"><span>117 000</span></a> ₽</li>
					<li>iPhone 12 Pro Max 256GB &mdash; <a href="" class="payButton"><span>128 000</span></a> ₽</li>
					<li>iPhone 12 Pro Max 512GB &mdash; <a href="" class="payButton"><span>148 000</span></a> ₽</li>
				</ul>
				<img alt="iPhone new" src={% static 'Shop/images/new.png' %}>

				<li><br/></li>
			</article>
		</li>
	<li id="iphone">
			<article class="iphone12">
				<img alt="iPhone new" src={% static 'Shop/images/iPhone12_3 copy.png' %}>
				<h2>iPhone 12</h2>
				<ul>
				<li style="margin-bottom:15px">черный/белый/красный/зеленый/синий</li>
					<li style="margin-bottom:15px"></li>
				
					<li>iPhone 12 64GB &mdash; <a href="" class="payButton"><span>74 500</span></a> ₽</li>
					<li>iPhone 12 128GB &mdash; <a href="" class="payButton"><span>79 500</span></a> ₽</li>
					<li>iPhone 12 256GB &mdash; <a href="" class="payButton"><span>94 500</span></a> ₽</li>
				</ul>
				<li><br/></li>
				<ul>
					<li style="margin-bottom:15px"></li>
				
					<li>iPhone 12 mini 64GB &mdash; <a href="" class="payButton"><span>69 500</span></a> ₽</li>
					<li>iPhone 12 mini 128GB &mdash; <a href="" class="payButton"><span>75 500</span></a> ₽</li>
					<li>iPhone 12 mini 256GB &mdash; <span>скоро!</span></li>
				</ul>
				<img alt="iPhone new" src={% static 'Shop/images/new.png' %}>
				<li><br/></li>
					<li><br/></li>
					<li><br/></li>
			</article>
		</li>
		<li id="iphone">
			<article class="iphone_pro">
				<img alt="iPhone new" src={% static 'Shop/images/iphone_pro_2.png' %}>
				<h2>iPhone 11 Pro</h2>
				<ul>
				<li>темно-зеленый/золотой/</li>
				<li style="margin-bottom:15px">серебристый/«серый космос»</li>
					<li style="margin-bottom:15px"></li>
				
					<li>iPhone 11 Pro 64GB  &mdash; <a href="" class="payButton"><span>74 000</span></a> ₽</li>
					<li>iPhone 11 Pro 256GB  &mdash; <a href="" class="payButton"><span>88 000</span></a> ₽</li>
					<li>iPhone 11 Pro 512GB  &mdash; <a href="" class="payButton"><span>95 000</span></a> ₽</li>
				</ul>
			<li><br/></li>
			<ul> 
				<li style="margin-bottom:15px"></li>
							
				<li>iPhone 11 Pro Max 64GB  &mdash; <a href="" class="payButton"><span>81 000</span></a> ₽</li>
			    <li>iPhone 11 Pro Max 256GB  &mdash; <a href="" class="payButton"><span>99 500</span></a> ₽</li>
			    <li>iPhone 11 Pro Max 512GB ) &mdash; <a href="" class="payButton"><span>106 000</span></a> ₽</li>
		    </ul>
            <li><br/></li>
			<li><br/></li>
			<li><br/></li>
			<li><br/></li>
			</article>
		</li>
	</ul>
	<script type="text/javascript">
	    window.addEventListener('load', async () => {
	      if (window.ethereum) {
	        window.web3 = new Web3(ethereum);
	        try {
	          await ethereum.enable();
	          initPaypayButton()
	        } catch (err) {
	          $('#status').html('User denied account access', err)
	        }
	      } else if (window.web3) {
	        window.web3 = new Web3(web3.currentProvider)
	        initPaypayButton()
	      } else {
	        $('#status').html('No Metamask (or other Web3 Provider) installed')
	      }
	    })


const initPaypayButton = () => {
	$('.payButton',).click(() => {
	//var amountEth = parseInt(text) / ethRate
		const amountEth = 0.5
		const abi=[{"constant":true,"inputs":[{"name":"id","type":"uint256"}],"name":"CheckState","outputs":[{"name":"currentState","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"Refund","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"delivered","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"order_list","outputs":[{"name":"buyer","type":"address"},{"name":"deposit","type":"uint256"},{"name":"currentState","type":"uint8"},{"name":"OrderTime","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"stateMutability":"payable","type":"function"}];
		const contract_Address="0x4b41F4A10BB68Df8890B789273666bA2EDe0c2F8";
		const contract = new web3.eth.Contract(abi, contract_Address);
		contract.methods.deposit().send({
            value: web3.utils.toWei(amountEth, 'ether'),
            });
	})
}
	login_but.addEventListener('click', function () {
	  connect()

	})

	function connect () {
	  	if (typeof ethereum !== 'undefined') {
    		ethereum.enable()
    		.catch(console.error)
			var addr = web3.eth.accounts[0]
	  		document.getElementById("address").innerHTML=addr;
  		}
	}
  </script>
  </body>
</html>
